<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Narubrew - Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .drop-zone {
        border: 2px dashed var(--bs-primary);
        border-radius: 10px;
        padding: 2rem;
        text-align: center;
        color: #ccc;
        cursor: pointer;
        transition: background-color 0.2s;
        max-width: 100%;
    }
    .drop-zone.dragover {
        background-color: #1e1e2e;
        border-color: #9f6bff;
        color: #fff;
    }
    .preview-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 2rem;
        justify-content: center;
    }
    .preview-item {
        width: 180px;
        border: 1px solid #444;
        border-radius: 8px;
        padding: 0.5rem;
        background-color: #222;
        color: white;
        text-align: center;
    }
    .preview-item img, .preview-item video {
        max-width: 100%;
        border-radius: 4px;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<div th:replace="~{fragments :: navbar(${currentUri})}"></div>

<main class="container py-5 d-flex flex-column min-vh-100">

  <h1 class="text-center mb-4" style="color: var(--bs-primary); margin-top: 2rem;">
    Upload Your Media
  </h1>

  <!-- PREVIEW GRID FIRST -->
  <div id="preview-grid" class="preview-grid mb-4"></div>

  <!-- DROP ZONE UNDERNEATH -->
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8 col-xl-7">
      <div class="drop-zone" id="drop-zone">
        <p>Drag and drop images or videos here,<br>or click to browse files</p>
        <input type="file" id="file-input" accept="image/*,video/*" multiple hidden>
      </div>
    </div>
  </div>
</main>

<div th:replace="~{fragments :: footer}"></div>

<div th:replace="~{fragments :: scripts}"></div>
<script>
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const previewGrid = document.getElementById('preview-grid');

  dropZone.addEventListener('click', () => fileInput.click());

  dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
  });

  dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
  });

  dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
  });

  fileInput.addEventListener('change', () => {
      handleFiles(fileInput.files);
  });

  function handleFiles(files) {
      [...files].forEach(file => {
          const reader = new FileReader();
          reader.onload = function (e) {
              const div = document.createElement('div');
              div.classList.add('preview-item');

              const ext = file.name.split('.').pop().toLowerCase();
              if (file.type.startsWith('image/')) {
                  div.innerHTML = `<img src="${e.target.result}" alt="${file.name}"><input type="text" class="form-control mt-2" placeholder="Tags...">`;
              } else if (file.type.startsWith('video/')) {
                  div.innerHTML = `<video src="${e.target.result}" controls></video><input type="text" class="form-control mt-2" placeholder="Tags...">`;
              } else {
                  return; // skip unsupported
              }

              previewGrid.appendChild(div);
          };
          reader.readAsDataURL(file);
      });
  }
</script>

</body>
</html>
